<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CBT Questions</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-100 min-h-screen flex flex-col items-center p-6">
    <h1 class="text-3xl font-bold text-gray-800 mb-4">Questions</h1>

    <!-- Timer Display -->
    <div class="text-xl font-semibold text-red-600 mb-6">
      Time Remaining: <span id="timer">02:00:00</span>
    </div>

    <div class="w-full max-w-xl">
      <form id="quizForm" action="/calculateResults" method="post">
        <% questions.forEach(function(val, qIndex){ %>
        <div
          class="mb-8 p-6 bg-white rounded-lg shadow-md"
          data-qindex="<%= qIndex %>"
        >
          <h2 class="text-xl font-semibold text-gray-700 mb-4">
            <%= qIndex+1 %>. 
            <%= val.question %>
          </h2>

          <!-- Marks Display -->
          <div class="mb-4 text-gray-600">
            Marks: <%= val.marks %>
          </div>


          <div class="flex flex-col gap-2">
            <% val.options.forEach(function(option, optionIndex){ %>
            <button
              type="button"
              class="option-btn w-full px-4 py-2 border-2 border-blue-500 rounded-lg text-gray-700 hover:bg-blue-500 hover:text-white transition-colors"
              data-option="<%= option %>"
            >
              <%= option %>
            </button>
            <% }) %>
          </div>

          <!-- Hidden input for storing selected option -->
          <input type="hidden" name="answers[<%= qIndex %>]" />
          <input type="hidden" name="marks" value="<%=val.marks%>" />
          <input
            type="hidden"
            name="negativeMarks"
            value="<%=val.negativeMarks%>"
          />
        </div>
        <% }) %>

        <button
          type="submit"
          class="w-full py-3 px-4 bg-green-500 text-white font-bold rounded-lg hover:bg-green-600 transition-colors"
        >
          Submit All Answers
        </button>
      </form>
    </div>

    <script>
      // Option selection
      document.querySelectorAll("div[data-qindex]").forEach((questionDiv) => {
        const optionButtons = questionDiv.querySelectorAll(".option-btn");

        optionButtons.forEach((btn, optionIndex) => {
          btn.addEventListener("click", () => {
            const hiddenInput = questionDiv.querySelector(
              'input[type="hidden"]'
            );

            // Store option index per question
            hiddenInput.value = optionIndex + 1;

            // Highlight selected button
            optionButtons.forEach((b) => {
              b.classList.remove("bg-blue-500", "text-white");
              b.classList.add("text-gray-700");
            });
            btn.classList.add("bg-blue-500", "text-white");
          });
        });
      });

      // Countdown Timer (2 hours = 7200 seconds)
      const totalTime = 7200; // seconds
      let timeLeft = totalTime;
      const timerDisplay = document.getElementById("timer");
      const quizForm = document.getElementById("quizForm");

      function formatTime(seconds) {
        const h = Math.floor(seconds / 3600)
          .toString()
          .padStart(2, "0");
        const m = Math.floor((seconds % 3600) / 60)
          .toString()
          .padStart(2, "0");
        const s = Math.floor(seconds % 60)
          .toString()
          .padStart(2, "0");
        return `${h}:${m}:${s}`;
      }

      const timerInterval = setInterval(() => {
        timerDisplay.textContent = formatTime(timeLeft);
        if (timeLeft <= 0) {
          clearInterval(timerInterval);
          alert("Time is up! Your test will be submitted automatically.");
          quizForm.submit(); // auto-submit form
        }
        timeLeft--;
      }, 1000);
    </script>
  </body>
</html>
